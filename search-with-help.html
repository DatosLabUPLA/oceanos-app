<!DOCTYPE html>
<html lang="es">
    <head>
        <meta charset="utf-8">
        <meta content="width=device-width, initial-scale=1.0" name="viewport">
        <title>App Océano - Buscador</title>
        <meta content="" name="description">
        <meta content="" name="keywords">

        <!-- Favicons -->
        <link href="assets/img/favicon.png" rel="icon">
        <link href="assets/img/apple-touch-icon.png" rel="apple-touch-icon">

        <!-- Google Fonts -->
        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link href="https://fonts.googleapis.com/css2?family=Open+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,600;1,700&family=Roboto:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&family=Work+Sans:ital,wght@0,300;0,400;0,500;0,600;0,700;1,300;1,400;1,500;1,600;1,700&display=swap" rel="stylesheet">

        <!-- Vendor CSS Files -->
        <link href="assets/vendor/bootstrap/css/bootstrap.min.css" rel="stylesheet">
        <link href="assets/vendor/bootstrap-icons/bootstrap-icons.css" rel="stylesheet">
        <link href="assets/vendor/fontawesome-free/css/all.min.css" rel="stylesheet">
        <link href="assets/vendor/aos/aos.css" rel="stylesheet">
        <link href="assets/vendor/glightbox/css/glightbox.min.css" rel="stylesheet">
        <link href="assets/vendor/swiper/swiper-bundle.min.css" rel="stylesheet">

        <!-- Template Main CSS File -->
        <link href="assets/css/main.css" rel="stylesheet">
        <link href="assets/css/mobile.css" rel="stylesheet">
    </head>

    <body class="bodyone d-flex p-5">
        <!-- ======= Header ======= -->
        <header id="header" class="header d-flex align-items-center">
            <div class="container-sm d-flex align-items-center justify-content-between">
                <div>
                    <a href="index.html" class="logo d-flex align-items-center">
                        <img src="assets/img/LOGO-APP-OCEANOS.png" alt="Logo app oceanos">
                    </a>
                </div>
                <i class="mobile-nav-toggle mobile-nav-show bi bi-list"></i>
                <i class="mobile-nav-toggle mobile-nav-hide d-none bi bi-x"></i>
                <nav id="navbar" class="navbar">
                    <ul>
                        <li><a href="mobile.html">Inicio</a></li>
                        <li><a href="search_FlorayFauna.html">Flora y Fauna</a></li>
                        <li><a href="search-with-help.html" class="active">Buscador con Ayuda</a></li>
                        <li><a href="desafios.html">Desafíos</a></li>
                        <li><a href="index.html#contact">Contáctanos</a></li>
                    </ul>
                </nav>
            </div>
        </header>

        <div class="container">
            <div class="row">
                <div class="col-12 text-center pt-5">
                    <h1>Buscador de Especies</h1>
                </div>
            </div>
            
            <form id="search-with-help">
                <div class="row mb-3">
                    <div class="col-4">
                        <label for="categoria" class="form-label">Categoría</label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" id="categoria" name="categoria" placeholder="Categoría">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-4">
                        <label for="tipo" class="form-label">Tipo</label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" id="tipo" name="tipo" placeholder="Tipo">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-4">
                        <label for="nombre_comun" class="form-label">Nombre Común</label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" id="nombre_comun" name="nombre_comun" placeholder="Nombre Común">
                    </div>
                </div>

                <div class="row mb-3">
                    <div class="col-4">
                        <label for="nombre_cientifico" class="form-label">Nombre Científico</label>
                    </div>
                    <div class="col-8">
                        <input type="text" class="form-control" id="nombre_cientifico" name="nombre_cientifico" placeholder="Nombre Científico">
                    </div>
                </div>

                <div class="text-center pt-5">
                    <button type="submit" class="butonsearch btn col-10">Ver resultados</button>
                </div>
            </form>

            <div id="search-results" class="mt-4"></div>
        </div>

        <!-- Vendor JS Files -->
        <script src="assets/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
        <script src="assets/vendor/aos/aos.js"></script>
        <script src="assets/vendor/glightbox/js/glightbox.min.js"></script>
        <script src="assets/vendor/isotope-layout/isotope.pkgd.min.js"></script>
        <script src="assets/vendor/swiper/swiper-bundle.min.js"></script>
        <script src="assets/vendor/purecounter/purecounter_vanilla.js"></script>
        <script src="assets/vendor/php-email-form/validate.js"></script>

        <script>
            // Utility function to remove accents and normalize text
            function normalizeText(text) {
                // Check if text is null or undefined
                if (!text) return '';
                
                return text.toString().toLowerCase()
                    .trim()
                    .normalize('NFD')
                    .replace(/[\u0300-\u036f]/g, '');
            }

            document.addEventListener('DOMContentLoaded', function () {
                const form = document.getElementById('search-with-help');
                const resultContainer = document.getElementById('search-results');

                form.addEventListener('submit', function (event) {
                    event.preventDefault();

                    // Collect search parameters
                    const searchParams = {};
                    ['categoria', 'tipo', 'nombre_comun', 'nombre_cientifico']
                        .forEach(function(field) {
                            const value = document.getElementById(field).value.trim();
                            if (value) {
                                searchParams[field] = normalizeText(value);
                            }
                        });

                    // If no search parameters, show an error
                    if (Object.keys(searchParams).length === 0) {
                        resultContainer.innerHTML = '<div class="alert alert-warning">Por favor, ingrese al menos un criterio de búsqueda.</div>';
                        return;
                    }

                    // Construct the search query
                    const queryString = Object.keys(searchParams)
                        .map(key => `${encodeURIComponent(key)}=${encodeURIComponent(searchParams[key])}`)
                        .join('&');

                    // Show loading indicator
                    resultContainer.innerHTML = '<div class="text-center"><div class="spinner-border" role="status"><span class="sr-only">Cargando...</span></div></div>';

                    // Perform the API request
                    fetch(`https://your-api-domain.com/search/?${queryString}`, {
                        method: 'GET',
                        headers: {
                            'Accept': 'application/json',
                            'Content-Type': 'application/json'
                        }
                    })
                    .then(function (response) {
                        if (!response.ok) {
                            throw new Error(`HTTP error! status: ${response.status}`);
                        }
                        return response.json();
                    })
                    .then(function (data) {
                        // Check if there are results
                        if (data.length > 0) {
                            // Create a more detailed display of results
                            let resultsHTML = '<h2>Resultados de la búsqueda:</h2>';
                            resultsHTML += '<div class="row">';
                            
                            data.forEach(function(item) {
                                resultsHTML += `
                                    <div class="col-md-4 mb-3">
                                        <div class="card">
                                            <div class="card-body">
                                                <h5 class="card-title">${escapeHTML(item.nombre_comun) || 'Sin nombre común'}</h5>
                                                <h6 class="card-subtitle mb-2 text-muted">${escapeHTML(item.nombre_cientifico) || 'Sin nombre científico'}</h6>
                                                <p class="card-text">
                                                    <strong>Categoría:</strong> ${escapeHTML(item.categoria) || 'No especificada'}<br>
                                                    <strong>Tipo:</strong> ${escapeHTML(item.tipo) || 'No especificado'}
                                                </p>
                                            </div>
                                        </div>
                                    </div>
                                `;
                            });
                            
                            resultsHTML += '</div>';
                            resultContainer.innerHTML = resultsHTML;
                        } else {
                            // Show message if no results found
                            resultContainer.innerHTML = '<div class="alert alert-info">No se encontraron resultados.</div>';
                        }
                    })
                    .catch(function (error) {
                        // Show error message
                        resultContainer.innerHTML = `<div class="alert alert-danger">Error al realizar la solicitud: ${error.message}</div>`;
                    });
                });

                // Utility function to escape HTML to prevent XSS
                function escapeHTML(str) {
                    if (!str) return '';
                    return str.toString()
                        .replace(/&/g, '&amp;')
                        .replace(/</g, '&lt;')
                        .replace(/>/g, '&gt;')
                        .replace(/"/g, '&quot;')
                        .replace(/'/g, '&#039;');
                }
            });
        </script>
    
        <!-- Template Main JS File -->
        <script src="assets/js/main.js"></script>
    </body>
</html>
